<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_31) on Fri Apr 27 09:47:29 CDT 2012 -->
<TITLE>
PersistentObject (Java Class Library API)
</TITLE>

<META NAME="date" CONTENT="2012-04-27">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="PersistentObject (Java Class Library API)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/PersistentObject.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentFileTransaction.html" title="class in org.dellroad.stuff.pobj"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?org/dellroad/stuff/pobj/PersistentObject.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="PersistentObject.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
org.dellroad.stuff.pobj</FONT>
<BR>
Class PersistentObject&lt;T&gt;</H2>
<PRE>
<A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</A>
  <IMG SRC="../../../../resources/inherit.gif" ALT="extended by "><B>org.dellroad.stuff.pobj.PersistentObject&lt;T&gt;</B>
</PRE>
<DL>
<DT><DT><B>Type Parameters:</B><DD><CODE>T</CODE> - type of the root persistent object</DL>
<HR>
<DL>
<DT><PRE>public class <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.123"><B>PersistentObject&lt;T&gt;</B></A><DT>extends <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></DL>
</PRE>

<P>
Main class for Simple XML Persistence Objects (POBJ).

 <h3>Overview</h3>

 <p>
 Instances model an in-memory "database" represented by a root Java object and the graph of other objects that
 it references. The object graph is backed by a persistent XML file, which is read at initialization time and
 re-written after each change.

 <p>
 Changes are applied "wholesale" to the entire object graph, and are serialized and atomic. In other words, the
 entire object graph is read from, and written to, this class by value. As a result, it is not possible to change
 only a portion of the "database". The entire object graph is read and written as one thing. Similarly, the
 persistent XML file is updated by writing out a new, temporary copy and renaming the copy onto the original,
 using <A HREF="http://download.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true#renameTo(java.io.File)" title="class or interface in java.io"><CODE>File.renameTo()</CODE></A> for atomicity (on systems that support it, e.g., UNIX variants).

 <h3>Update Details</h3>

 <p>
 When the object graph is updated, it must pass validation checks, and then the persistent XML file is updated and
 listener notifications are sent out. Support for delayed write-back of the persistent XML file is included: this
 allows modifications that occur in rapid succession to be consolidated into a single filesystem write operation.

 <p>
 Support for optimistic locking is included. There is a "current version" number which is incremented each
 time the object graph is updated; writes may optionally specify this number to ensure no intervening changes
 have occurred. If concurrent updates are expected, applications may choose to implement a 3-way merge algorithm
 of some kind to handle optimistic locking failures.

 <p>
 Instances can be configured to preserve one or more backup copies of the persistent file on systems that support
 hard links (requires <a href="https://github.com/twall/jna">JNA</a>; see <A HREF="../../../../org/dellroad/stuff/io/HardLink.html" title="class in org.dellroad.stuff.io"><CODE>HardLink</CODE></A>).
 Set the <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getNumBackups()"><CODE>numBackups</CODE></A> property to enable.

 <h3>"Out-of-band" Writes</h3>

 <p>
 When a non-zero <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getCheckInterval()">check interval</A> is configured, instances support "out-of-band" writes
 to the XML persistent file by some other process. This can be handy in cases where the other process (perhaps hand edits)
 is updating the persistent file and you want to have a running process pick up the changes just as if
 <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)"><CODE>setRoot()</CODE></A> had been invoked. In particular, instances will detect the appearance
 of a new persistent file after an instance has started without one. In all cases, persistent objects must properly validate.

 <p>
 A special case of this is effected when <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)"><CODE>setRoot()</CODE></A> is never explicitly invoked
 by the application. Then some other process must be responsible for all database updates, and this class automatically
 picks them up, validates them, and send out notifications.

 <h3>Empty Starts and Stops</h3>

 <p>
 An "empty start" occurs when an instance is <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#start()">started</A> but the persistent XML file is either missing,
 does not validate, or cannot be read for some other reason. In such cases, the instance will start with no object graph,
 and <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getRoot()"><CODE>getRoot()</CODE></A> will return null. This situation will correct itself as soon as the object graph is written via
 <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)"><CODE>setRoot()</CODE></A> or the persistent file appears (effecting an "out-of-band" update). At that time, <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#addListener(org.dellroad.stuff.pobj.PersistentObjectListener)">listeners</A> will be notified for the first time, with <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectEvent.html#getOldRoot()"><CODE>PersistentObjectEvent.getOldRoot()</CODE></A> returning null.

 <p>
 Whether empty starts are allowed is determined by the <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#isAllowEmptyStart()"><CODE>allowEmptyStart</CODE></A> property (default
 <code>false</code>). When empty starts are disallowed and the persistent XML file cannot be successfully read,
 then <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#start()"><CODE>start()</CODE></A> will instead throw an immediate <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj"><CODE>PersistentObjectException</CODE></A>.

 <p>
 Similarly, "empty stops" are allowed when the <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#isAllowEmptyStop()"><CODE>allowEmptyStop</CODE></A> property is set to <code>true</code>
 (by default it is <code>false</code>). An "empty stop" occurs when a null value is passed to <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)"><CODE>setRoot()</CODE></A>.
 Subsequent invocations of <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getRoot()"><CODE>getRoot()</CODE></A> will return <code>null</code>; however, the persistent file is <b>not</b>
 modified when null is passed to <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)"><CODE>setRoot(T, long)</CODE></A>. When empty stops are disallowed, then invoking
 <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)"><CODE>setRoot(T, long)</CODE></A> with a <code>null</code> object will result in an <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang"><CODE>IllegalArgumentException</CODE></A>.

 <p>
 Allowing empty starts and/or stops essentially creates an "unconfigured" state represented by a null root object.
 When empty starts and empty stops are both disallowed, there is no "unconfigured" state: <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getRoot()"><CODE>getRoot()</CODE></A> can be
 relied upon to always return a non-null, validated root object.

 <h3>Delegate Function</h3>

 <p>
 Instances must be configured with a <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj"><CODE>PersistentObjectDelegate</CODE></A> that knows how to validate the object graph
 and perform conversions to and from XML. See <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj"><CODE>PersistentObjectDelegate</CODE></A> and its implementations for details.

 <h3>Schema Changes</h3>

 <p>
 Like any database, the XML schema may evolve over time. The <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectSchemaUpdater.html" title="class in org.dellroad.stuff.pobj"><CODE>PersistentObjectSchemaUpdater</CODE></A> class provides a simple
 way to apply and manage schema updates using XSLT transforms.
<P>

<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj"><CODE>PersistentObjectDelegate</CODE></A></DL>
<HR>

<P>
<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="http://www.slf4j.org/api/org/slf4j/Logger.html?is-external=true" title="class or interface in org.slf4j">Logger</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#log">log</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#PersistentObject(org.dellroad.stuff.pobj.PersistentObjectDelegate, java.io.File)">PersistentObject</A></B>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectDelegate</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;delegate,
                                 <A HREF="http://download.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</A>&nbsp;file)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Simplified constructor configuring for immediate write-back and no persistent file checks.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#PersistentObject(org.dellroad.stuff.pobj.PersistentObjectDelegate, java.io.File, long, long)">PersistentObject</A></B>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectDelegate</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;delegate,
                                 <A HREF="http://download.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</A>&nbsp;file,
                                 long&nbsp;writeDelay,
                                 long&nbsp;checkInterval)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constructor.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#addListener(org.dellroad.stuff.pobj.PersistentObjectListener)">addListener</A></B>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectListener</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;listener)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add a listener to be notified each time the object graph changes.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#checkFile()">checkFile</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check the persistent file for an "out-of-band" update.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;long</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getCheckInterval()">getCheckInterval</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the delay time between periodic checks for changes in the underlying persistent file.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectDelegate</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getDelegate()">getDelegate</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the configured <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj"><CODE>PersistentObjectDelegate</CODE></A>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getNumBackups()">getNumBackups</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the number of backup copies to preserve.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="http://download.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getPersistentFile()">getPersistentFile</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the persistent file containing the XML form of the persisted object.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getRoot()">getRoot</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Atomically read the root object.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getSharedRoot()">getSharedRoot</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get a shared copy of the root object.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;long</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getVersion()">getVersion</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the version of the current root.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;long</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getWriteDelay()">getWriteDelay</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the maximum delay after an update operation before a write-back to the persistent file
 must be initiated.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#isAllowEmptyStart()">isAllowEmptyStart</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Determine whether this instance should allow an "empty start".</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#isAllowEmptyStop()">isAllowEmptyStop</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Determine whether this instance should allow an "empty stop".</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#isStarted()">isStarted</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Determine whether this instance is started.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#notifyListeners(long, T, T)">notifyListeners</A></B>(long&nbsp;newVersion,
                               <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;oldRoot,
                               <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;newRoot)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Notify listeners of a change in value.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#read()">read</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read the persistent file.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#removeListener(org.dellroad.stuff.pobj.PersistentObjectListener)">removeListener</A></B>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectListener</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;listener)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remove a listener added via <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#addListener(org.dellroad.stuff.pobj.PersistentObjectListener)"><CODE>addListener()</CODE></A>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setAllowEmptyStart(boolean)">setAllowEmptyStart</A></B>(boolean&nbsp;allowEmptyStart)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Configure whether an "empty start" is allowed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setAllowEmptyStop(boolean)">setAllowEmptyStop</A></B>(boolean&nbsp;allowEmptyStop)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Configure whether an "empty stop" is allowed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setNumBackups(int)">setNumBackups</A></B>(int&nbsp;numBackups)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set the number of backup copies to preserve.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T)">setRoot</A></B>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;newRoot)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Atomically update the root object.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)">setRoot</A></B>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;newRoot,
               long&nbsp;expectedVersion)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Atomically update the root object.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#start()">start</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start this instance.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#stop()">stop</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stop this instance.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#toString()">toString</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get a simple string description of this instance.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#write(T)">write</A></B>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;obj)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write the persistent file and rotate any backups.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.<A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</A>, <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="log"><!-- --></A><H3>
log</H3>
<PRE>
protected final <A HREF="http://www.slf4j.org/api/org/slf4j/Logger.html?is-external=true" title="class or interface in org.slf4j">Logger</A> <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.127"><B>log</B></A></PRE>
<DL>
<DL>
</DL>
</DL>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="PersistentObject(org.dellroad.stuff.pobj.PersistentObjectDelegate, java.io.File, long, long)"><!-- --></A><H3>
PersistentObject</H3>
<PRE>
public <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.162"><B>PersistentObject</B></A>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectDelegate</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;delegate,
                        <A HREF="http://download.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</A>&nbsp;file,
                        long&nbsp;writeDelay,
                        long&nbsp;checkInterval)</PRE>
<DL>
<DD>Constructor.

 <p>
 The <code>writeDelay</code> is the maximum delay after an update operation before a write-back to the persistent file
 must be initiated.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>delegate</CODE> - delegate supplying required operations<DD><CODE>file</CODE> - the file used to persist<DD><CODE>writeDelay</CODE> - write delay in milliseconds, or zero for immediate write-back<DD><CODE>checkInterval</CODE> - check interval in milliseconds, or zero to disable persistent file checks
<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</A></CODE> - if <code>delegate</code> or <code>file</code> is null
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</A></CODE> - if <code>writeDelay</code> or <code>checkInterval</code> is negative</DL>
</DL>
<HR>

<A NAME="PersistentObject(org.dellroad.stuff.pobj.PersistentObjectDelegate, java.io.File)"><!-- --></A><H3>
PersistentObject</H3>
<PRE>
public <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.186"><B>PersistentObject</B></A>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectDelegate</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;delegate,
                        <A HREF="http://download.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</A>&nbsp;file)</PRE>
<DL>
<DD>Simplified constructor configuring for immediate write-back and no persistent file checks.

 <p>
 Equivalent to:
 <blockquote><code>
  PersistentObject(delegate, file, 0L, 0L);
 </code></blockquote>
<P>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="getPersistentFile()"><!-- --></A><H3>
getPersistentFile</H3>
<PRE>
public <A HREF="http://download.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</A> <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.193"><B>getPersistentFile</B></A>()</PRE>
<DL>
<DD>Get the persistent file containing the XML form of the persisted object.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getWriteDelay()"><!-- --></A><H3>
getWriteDelay</H3>
<PRE>
public long <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.203"><B>getWriteDelay</B></A>()</PRE>
<DL>
<DD>Get the maximum delay after an update operation before a write-back to the persistent file
 must be initiated.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>write delay in milliseconds, or zero for immediate write-back</DL>
</DD>
</DL>
<HR>

<A NAME="getCheckInterval()"><!-- --></A><H3>
getCheckInterval</H3>
<PRE>
public long <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.212"><B>getCheckInterval</B></A>()</PRE>
<DL>
<DD>Get the delay time between periodic checks for changes in the underlying persistent file.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>check interval in milliseconds, or zero if periodic checks are disabled</DL>
</DD>
</DL>
<HR>

<A NAME="getVersion()"><!-- --></A><H3>
getVersion</H3>
<PRE>
public long <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.226"><B>getVersion</B></A>()</PRE>
<DL>
<DD>Get the version of the current root.

 <p>
 This returns a value which increases monotonically with each update.
 The version number is not persisted with the persistent file; each instance of this class keeps
 its own version count. The version is reset to zero when <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#stop()"><CODE>stop()</CODE></A> is invoked.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>the current object version, or zero if no value has been loaded yet</DL>
</DD>
</DL>
<HR>

<A NAME="getNumBackups()"><!-- --></A><H3>
getNumBackups</H3>
<PRE>
public int <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.243"><B>getNumBackups</B></A>()</PRE>
<DL>
<DD>Get the number of backup copies to preserve.

 <p>
 Backup files have suffixes of the form <code>.1</code>,  <code>.2</code>, etc.,
 in reverse chronological order. Each time a new root object is written, the existing files are rotated.

 <p>
 Back-ups are created via hard links and are only supported on UNIX systems.

 <p>
 The default is zero, which disables backups.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="setNumBackups(int)"><!-- --></A><H3>
setNumBackups</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.253"><B>setNumBackups</B></A>(int&nbsp;numBackups)</PRE>
<DL>
<DD>Set the number of backup copies to preserve.
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</A></CODE> - if <code>numBackups</code> is negative<DT><B>See Also:</B><DD><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getNumBackups()"><CODE>getNumBackups()</CODE></A></DL>
</DD>
</DL>
<HR>

<A NAME="isAllowEmptyStart()"><!-- --></A><H3>
isAllowEmptyStart</H3>
<PRE>
public boolean <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.265"><B>isAllowEmptyStart</B></A>()</PRE>
<DL>
<DD>Determine whether this instance should allow an "empty start".

 <p>
 The default for this property is false.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="setAllowEmptyStart(boolean)"><!-- --></A><H3>
setAllowEmptyStart</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.275"><B>setAllowEmptyStart</B></A>(boolean&nbsp;allowEmptyStart)</PRE>
<DL>
<DD>Configure whether an "empty start" is allowed.

 <p>
 The default for this property is false.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="isAllowEmptyStop()"><!-- --></A><H3>
isAllowEmptyStop</H3>
<PRE>
public boolean <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.285"><B>isAllowEmptyStop</B></A>()</PRE>
<DL>
<DD>Determine whether this instance should allow an "empty stop".

 <p>
 The default for this property is false.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="setAllowEmptyStop(boolean)"><!-- --></A><H3>
setAllowEmptyStop</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.295"><B>setAllowEmptyStop</B></A>(boolean&nbsp;allowEmptyStop)</PRE>
<DL>
<DD>Configure whether an "empty stop" is allowed.

 <p>
 The default for this property is false.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="isStarted()"><!-- --></A><H3>
isStarted</H3>
<PRE>
public boolean <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.302"><B>isStarted</B></A>()</PRE>
<DL>
<DD>Determine whether this instance is started.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="start()"><!-- --></A><H3>
start</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.311"><B>start</B></A>()</PRE>
<DL>
<DD>Start this instance. Does nothing if already started.
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</A></CODE> - if an error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="stop()"><!-- --></A><H3>
stop</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.356"><B>stop</B></A>()</PRE>
<DL>
<DD>Stop this instance. Does nothing if already stopped.
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</A></CODE> - if a delayed write back is pending and error occurs while performing the write</DL>
</DD>
</DL>
<HR>

<A NAME="getRoot()"><!-- --></A><H3>
getRoot</H3>
<PRE>
public <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A> <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.401"><B>getRoot</B></A>()</PRE>
<DL>
<DD>Atomically read the root object.

 <p>
 In the situation of an empty start or empty stop, this instance is "unconfigured" and null will be returned.
 This can only happen if <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setAllowEmptyStart(boolean)"><CODE>setAllowEmptyStart(true)</CODE></A> or <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setAllowEmptyStop(boolean)"><CODE>setAllowEmptyStop(true)</CODE></A> has been invoked.

 <p>
 This returns a deep copy of the current root object; any subsequent modifications are not written back.
 Use <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getSharedRoot()"><CODE>getSharedRoot()</CODE></A> instead to avoid the cost of the deep copy at the risk of seeing modifications
 caused by other invokers.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>the current root instance, or null during an empty start or empty stop
<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</A></CODE> - if this instance is not started
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</A></CODE> - if an error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="getSharedRoot()"><!-- --></A><H3>
getSharedRoot</H3>
<PRE>
public <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A> <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.422"><B>getSharedRoot</B></A>()</PRE>
<DL>
<DD>Get a shared copy of the root object.

 <p>
 This returns a copy of the root object, but it returns the same copy each time until the next change.
 This method is more efficient than <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getRoot()"><CODE>getRoot()</CODE></A>, but all callers must agree not to modify the returned object
 or any object in its graph of references.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>shared copy of the root instance, or null during an empty start or empty stop
<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</A></CODE> - if this instance is not started</DL>
</DD>
</DL>
<HR>

<A NAME="setRoot(java.lang.Object,long)"><!-- --></A><A NAME="setRoot(T, long)"><!-- --></A><H3>
setRoot</H3>
<PRE>
public final void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.457"><B>setRoot</B></A>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;newRoot,
                          long&nbsp;expectedVersion)</PRE>
<DL>
<DD>Atomically update the root object.

 <p>
 The given object is deep-copied and the copy replaces the current root.

 <p>
 If <code>expectedVersion</code> is non-zero, then if the current version is not equal to it,
 a <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectVersionException.html" title="class in org.dellroad.stuff.pobj"><CODE>PersistentObjectVersionException</CODE></A> exception is thrown. This mechanism
 can be used for optimistic locking.

 <p>
 If empty stops are allowed, then <code>newRoot</code> may be null, in which case it replaces the
 current root and subsequent calls to <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#getRoot()"><CODE>getRoot()</CODE></A> will return null. When a null
 <code>newRoot</code> is set, the persistent file is <b>not</b> modified.

 <p>
 If the given root object is <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html#isSameGraph(T, T)">the same as</A> the current
 root object, then no action is taken.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>newRoot</CODE> - new persistent object<DD><CODE>expectedVersion</CODE> - expected current version number, or zero to ignore the current version number
<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</A></CODE> - if <code>newRoot</code> is null and empty stops are disallowed
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</A></CODE> - if <code>version</code> is negative
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</A></CODE> - if this instance is not started
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</A></CODE> - if an error occurs
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectVersionException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectVersionException</A></CODE> - if <code>version</code> is non-zero and not equal to the current version
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectValidationException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectValidationException</A></CODE> - if the new root has validation errors</DL>
</DD>
</DL>
<HR>

<A NAME="setRoot(java.lang.Object)"><!-- --></A><A NAME="setRoot(T)"><!-- --></A><H3>
setRoot</H3>
<PRE>
public final void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.526"><B>setRoot</B></A>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;newRoot)</PRE>
<DL>
<DD>Atomically update the root object.

 <p>
 The is a convenience method, equivalent to:
  <blockquote>
  <code><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#setRoot(T, long)"><CODE>setRoot</CODE></A>(newRoot, 0)</code>
  </blockquote>

 <p>
 This method cannot throw <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectVersionException.html" title="class in org.dellroad.stuff.pobj"><CODE>PersistentObjectVersionException</CODE></A>.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="checkFile()"><!-- --></A><H3>
checkFile</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.540"><B>checkFile</B></A>()</PRE>
<DL>
<DD>Check the persistent file for an "out-of-band" update.

 <p>
 If the persistent file has a newer timestamp than the timestamp of the most recently read
 or written version, then it will be read and applied to this instance.
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</A></CODE> - if this instance is not started
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</A></CODE> - if an error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="addListener(org.dellroad.stuff.pobj.PersistentObjectListener)"><!-- --></A><H3>
addListener</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.565"><B>addListener</B></A>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectListener</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;listener)</PRE>
<DL>
<DD>Add a listener to be notified each time the object graph changes.
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</A></CODE> - if <code>listener</code> is null</DL>
</DD>
</DL>
<HR>

<A NAME="removeListener(org.dellroad.stuff.pobj.PersistentObjectListener)"><!-- --></A><H3>
removeListener</H3>
<PRE>
public void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.576"><B>removeListener</B></A>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectListener.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectListener</A>&lt;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&gt;&nbsp;listener)</PRE>
<DL>
<DD>Remove a listener added via <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html#addListener(org.dellroad.stuff.pobj.PersistentObjectListener)"><CODE>addListener()</CODE></A>.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="toString()"><!-- --></A><H3>
toString</H3>
<PRE>
public <A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A> <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.586"><B>toString</B></A>()</PRE>
<DL>
<DD>Get a simple string description of this instance. This description appears in all log messages.
<P>
<DD><DL>
<DT><B>Overrides:</B><DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</A></CODE> in class <CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></CODE></DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getDelegate()"><!-- --></A><H3>
getDelegate</H3>
<PRE>
protected <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj">PersistentObjectDelegate</A> <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.593"><B>getDelegate</B></A>()</PRE>
<DL>
<DD>Get the configured <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj"><CODE>PersistentObjectDelegate</CODE></A>.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="read()"><!-- --></A><H3>
read</H3>
<PRE>
protected <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A> <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.602"><B>read</B></A>()</PRE>
<DL>
<DD>Read the persistent file.
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</A></CODE> - if an error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="write(java.lang.Object)"><!-- --></A><A NAME="write(T)"><!-- --></A><H3>
write</H3>
<PRE>
protected final void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.649"><B>write</B></A>(<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;obj)</PRE>
<DL>
<DD>Write the persistent file and rotate any backups.

 <p>
 A temporary file is created in the same directory and then renamed to provide for an atomic update
 (on supporting operating systems).
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</A></CODE> - if <code>obj</code> is null
<DD><CODE><A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectException.html" title="class in org.dellroad.stuff.pobj">PersistentObjectException</A></CODE> - if an error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="notifyListeners(long,java.lang.Object,java.lang.Object)"><!-- --></A><A NAME="notifyListeners(long, T, T)"><!-- --></A><H3>
notifyListeners</H3>
<PRE>
protected void <A HREF="../../../../src-html/org/dellroad/stuff/pobj/PersistentObject.html#line.736"><B>notifyListeners</B></A>(long&nbsp;newVersion,
                               <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;oldRoot,
                               <A HREF="../../../../org/dellroad/stuff/pobj/PersistentObject.html" title="type parameter in PersistentObject">T</A>&nbsp;newRoot)</PRE>
<DL>
<DD>Notify listeners of a change in value.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>newVersion</CODE> - the version number associated with the new root</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/PersistentObject.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentFileTransaction.html" title="class in org.dellroad.stuff.pobj"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../org/dellroad/stuff/pobj/PersistentObjectDelegate.html" title="interface in org.dellroad.stuff.pobj"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?org/dellroad/stuff/pobj/PersistentObject.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="PersistentObject.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
